/*!
 * barick-tilify v1.0.0 (https://github.com/codotronix/barick-tilify)
 * Copyright 2016 Suman Barick
 * Licensed under the MIT license
 */"use strict";var tile_plugins={};!function($){$.fn.tilefy=function(config){return this.each(function(){function init(){calculateWidths(),makeGrids(),mapTilesToGrid(),drawTiles(),setStyles(),wakeUpLive(),bindDragAndDrop(),enableTileResize()}function reTilefy(){resetGrids(),mapTilesToGrid(),drawTiles(),setStyles()}function drawTiles(){var e="";container.addClass("barick-tiles-container "+page_Width_Class);var i;for(var t in tiles)i=tiles[t],e+='<div id="'+i.id+'" class="tile '+i.size+'" style="top:'+i.top+"px; left:"+i.left+'px;" data-gridid="'+i.gridId+'" ><a class="tileInnerContainer" target="'+(i.linkTarget||"_blank")+'" href="'+(i.link||"javascript:void(0)")+'" style="background: '+i.bgColor+';" >',"font"==i.contentType?e+='<span class="fontIcon '+i.icon+'"></span>':"live"==i.contentType?(e+='<div class="live">',void 0!=i.liveImgUrls&&(e+='<img  class="fontImg" src="'+i.liveImgUrls[0]+'" />'),void 0!=i.liveTxts&&(e+='<span class="liveTxt" style="color:'+i.fontColor+'">'+i.liveTxts[0]+"</span>"),e+="</div>"):"plugin"==i.contentType&&(e+='<div class="plugin"></div>'),e+='<label class="name">'+i.name+"</label>",e+="</a></div>";e+='<div style="position:absolute; left: 10px; right: 10px; height: 60px; top: '+clearSpaceDivPosition+'px" ></div>',container.html(e),loadPlugins()}function loadPlugins(){for(var i in tiles)"plugin"==tiles[i].contentType&&(tile_plugins[tiles[i].id]=tile_plugins[tiles[i].id]||{},tile_plugins[tiles[i].id].initFunc?eval(tile_plugins[tiles[i].id].initFunc):fetchPlugin(tiles[i].id))}function fetchPlugin(e){var i="tile_plugins/"+e+"/index.js";$.getScript(i,function(i,t,l){tile_plugins[e].initFunc=i})}function setStyles(){$(".tile.small").css({width:small_tile_size,height:small_tile_size}),$(".tile.medium").css({width:medium_tile_size,height:medium_tile_size}),$(".tile.big").css({width:big_tile_size,height:big_tile_size}),$(".tile.rectangle").css({width:big_tile_size,height:medium_tile_size}),$(".tile .fontIcon").each(function(){var e=$(this).closest(".tile").height();$(this).css({"font-size":e/2+"px","margin-top":e/8+"px"})})}function wakeUpLive(){var e=["slideInDown","slideInLeft","slideInRight","slideInUp","rotateIn","rollIn","zoomIn"],i=["fadeIn"];$(".tile .live").each(function(){function t(){tileMovementAllowed||tileResizeAllowed||(r=(r+1)%a,d=e[Math.floor(Math.random()*e.length)],$("#"+s).find(".fontImg").attr("src",o[r]).removeClass().addClass("fontImg animated "+d)),setTimeout(t,c)}function l(){tileMovementAllowed||tileResizeAllowed||(g=(g+1)%f,d=i[Math.floor(Math.random()*i.length)],$("#"+s).find(".liveTxt").text(n[g]).removeClass().addClass("liveTxt animated "+d)),setTimeout(l,c)}var s=$(this).closest(".tile").attr("id"),o=tiles[s].liveImgUrls,n=tiles[s].liveTxts;if(void 0!=o&&o.length>1){var r=0,a=o.length,d="",c=2500+Math.round(Math.random()*(5e3/a));t()}if(void 0!=n&&n.length>1){var g=0,f=n.length,d="",c=2500+Math.round(Math.random()*(5e3/f));l()}})}function calculateWidths(){var e=20,i=containerWidth-e;page_Width_Class="xs";gridsPerRow=config.gridCapacityPerRow||12,small_tile_size=Math.floor(i/gridsPerRow),i>=1200?(page_Width_Class="lg",gridsPerRow=config.gridCapacityPerRow||16,small_tile_size=Math.floor(i/gridsPerRow)):i>=992?(page_Width_Class="md",gridsPerRow=config.gridCapacityPerRow||12):i>=768?(page_Width_Class="sm",gridsPerRow=config.gridCapacityPerRow||12):(page_Width_Class="xs",gridsPerRow=config.gridCapacityPerRow||4,small_tile_size=Math.floor((i+e)/gridsPerRow)),medium_tile_size=2*small_tile_size,big_tile_size=4*small_tile_size}function noBigTileInXS(){if("xs"==page_Width_Class)for(var e in tiles)tiles[e].size="big"==tiles[e].size?"medium":tiles[e].size}function makeGrids(){var e=0;for(var i in tiles)"small"==tiles[i].size?e+=1:"medium"==tiles[i].size?e+=4:"rectangle"==tiles[i].size?e+=8:"big"==tiles[i].size&&(e+=16);var t=gridsPerRow*Math.ceil(e/gridsPerRow)*2;grids={};for(var l=0,s=1,i=1;t>=i;i++){l++,l>gridsPerRow&&(l=1,s++);var o={};o.indX=l,o.indY=s,o.id=l+"x"+s,o.occupiedBy="none",o.top=(s-1)*small_tile_size,o.left=(l-1)*small_tile_size,o.type="",grids[o.id]=o}}function resetGrids(){for(var e in grids)grids[e].occupiedBy="none",grids[e].type=""}function mapTilesToGrid(){clearSpaceDivPosition=0;var e="",i="";for(var t in tileOrder)e=tileOrder[t],i=placeTileOnGrid(tiles[e]),tiles[e].gridId=i,tiles[e].width="small"==tiles[e].size?small_tile_size:"medium"==tiles[e].size?medium_tile_size:big_tile_size,tiles[e].height="small"==tiles[e].size?small_tile_size:"big"==tiles[e].size?big_tile_size:medium_tile_size,tiles[e].bgColor=tiles[e].bgColor||colorCodes[Math.floor(Math.random()*colorCodes.length)],tiles[e].top=grids[i].top,tiles[e].left=grids[i].left,clearSpaceDivPosition=tiles[e].top+tiles[e].height>clearSpaceDivPosition?tiles[e].top+tiles[e].height:clearSpaceDivPosition}function placeTileOnGrid(e){for(var i in grids)if("none"==grids[i].occupiedBy){if("small"==e.size)return grids[i].occupiedBy=e.id,grids[i].type="startGrid",i;if(canItHoldTile(grids[i].id,e.size))return markGridsOccupied(grids[i].id,e.size,e.id),grids[i].type="startGrid",i}console.log("No Grid Avaialble for Tile id="+e.id)}function canItHoldTile(e,i){for(var t="medium"==i?2:4,l="big"==i?4:2,s=grids[e].indX,o=grids[e].indY,n=s+(t-1),r=o+(l-1),a="",d=!1,c=s;n>=c;c++){for(var g=o;r>=g;g++)if(a=c+"x"+g,void 0==grids[a]||void 0==typeof grids[a]||"none"!=grids[a].occupiedBy){d=!0;break}if(d)break}return!d}function markGridsOccupied(e,i,t){for(var l="medium"==i?2:4,s="big"==i?4:2,o=grids[e].indX,n=grids[e].indY,r=o+(l-1),a=n+(s-1),d="",c=o;r>=c;c++)for(var g=n;a>=g;g++)d=c+"x"+g,grids[d].occupiedBy=t}function bindDragAndDrop(){function e(){$(".tileResizeMenu").remove(),$("#"+config.btn_ID_to_Toggle_Tile_Movement).hasClass("on")?($("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("on").addClass("off"),tileMovementAllowed=!1,container.removeClass("movementMode"),reTilefy()):($("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("off").addClass("on"),tileMovementAllowed=!0,container.addClass("movementMode").removeClass("resizeMode"),tileResizeAllowed=!1,$("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("on").addClass("off"))}var i=null,t=null,l=!1,s=0,o=0;container.on("pointerdown",".tile",function(e){container.hasClass("movementMode")&&(e.preventDefault(),l||(i=$(this).attr("id"),l=!0,s=e.pageX,o=e.pageY,container.find(".tile").removeClass("being-dragged"),$(this).addClass("being-dragged")))}),$("body").on("pointerup",function(e){if(l){if(l=!1,$("body").trigger("click"),null!=t&&null!=i){var s=[];for(var o in tileOrder)tileOrder[o]!=i&&(tileOrder[o]==t?(s.push(i),s.push(t)):s.push(tileOrder[o]));s.length!=tileOrder.length?(console.log("length mismatch... Hence this order cannot be taken..."),console.log("current tile order"),console.log(tileOrder),console.log("new tile order"),console.log(s)):tileOrder=s}reTilefy(),i=null,t=null,$(".tile").removeClass("being-dragged")}}),container.on("pointerout",function(e){$("body").trigger("pointerup")}),$("body").on("pointermove",function(e){if(e.stopPropagation(),tileMovementAllowed&&l&&null!=i){var n=e.pageX-s,r=e.pageY-o;s=e.pageX,o=e.pageY;var a=parseInt($("#"+i).css("left")),d=parseInt($("#"+i).css("top")),c=d+r,g=a+n;for(var f in tiles)if(i!=tiles[f].id&&Math.abs(tiles[f].left-a)<small_tile_size&&Math.abs(tiles[f].top-d)<small_tile_size){container.find(".tile").removeClass("shift-effect"),t=tiles[f].id,$("#"+t).addClass("shift-effect");break}$("#"+i).css({top:c,left:g})}}),$("#"+config.btn_ID_to_Toggle_Tile_Movement).on("click",function(){e()})}function enableTileResize(){function e(){$(".tileResizeMenu").remove(),$("#"+config.btn_ID_to_Toggle_Tile_Resize).hasClass("on")?($("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("on").addClass("off"),tileResizeAllowed=!1,container.removeClass("resizeMode")):($("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("off").addClass("on"),tileResizeAllowed=!0,container.addClass("resizeMode").removeClass("movementMode"),tileMovementAllowed=!1,$("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("on").addClass("off"),reTilefy())}$("#"+config.btn_ID_to_Toggle_Tile_Resize).on("click",function(){e()});var i='<ul class="tileResizeMenu"><li>Small</li><li>Medium</li><li>Big</li><li>Rectangle</li></ul>';container.on("click",".tile",function(e){if(container.hasClass("resizeMode")){$(".tileResizeMenu").remove();var t=parseInt($(this).css("top"))+20,l=parseInt($(this).css("left"))+20;$(i).attr("data-tileID",$(this).attr("id")).css({top:t,left:l}).appendTo(container)}}),container.on("click",".tileResizeMenu li",function(e){var i=$(this).text().toLowerCase(),t=$(this).closest(".tileResizeMenu").attr("data-tileID");tiles[t].size!=i&&(tiles[t].size=i,reTilefy())})}var thisContainer=this,container=$(this),containerWidth=container.width(),tileOrder=config.TD.tileOrder,tiles=config.TD.tiles,grids={},gridsPerRow=0,page_Width_Class="xs",small_tile_size=0,medium_tile_size=0,big_tile_size=0,clearSpaceDivPosition=200,tileMovementAllowed=!1,tileResizeAllowed=!1,colorCodes=["#632F00","#B01E00","#C1004F","#4617B4","#008287","#199900","#00C13F","#FF2E12","#FF1D77","#AA40FF","#1FAEFF","#000","#00A3A3","#FE7C22"];init(),$("body").on("click",".tile a",function(e){(tileMovementAllowed||tileResizeAllowed)&&e.preventDefault()})})}}(jQuery);
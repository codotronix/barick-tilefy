/*!
 * barick-tilify v1.0.0 (https://github.com/codotronix/barick-tilify)
 * Copyright 2016 Suman Barick
 * Licensed under the MIT license
 */var tile_plugins={};!function($){$.fn.tilefy=function(config){return this.each(function(){function init(){calculateWidths(),makeGrids(),mapTilesToGrid(),drawTiles(),setStyles(),wakeUpLive(),bindDragAndDrop(),enableTileResize()}function reTilefy(){resetGrids(),mapTilesToGrid(),drawTiles(),setStyles()}function drawTiles(){var i="";container.addClass("barick-tiles-container "+page_Width_Class);var e;for(var l in tiles)e=tiles[l],i+='<div id="'+e.id+'" class="tile '+e.size+'" style="top:'+e.top+"px; left:"+e.left+'px;" data-gridid="'+e.gridId+'" ><a class="tileInnerContainer" target="_blank" href="'+(e.link||"javascript:void(0)")+'" style="background: '+e.bgColor+';" >',"font"==e.iconType?i+='<span class="fontIcon '+e.icon+'"></span>':"live"==e.iconType?(i+='<div class="live">',void 0!=e.liveImgUrls&&(i+='<img  class="fontImg" src="'+e.liveImgUrls[0]+'" />'),void 0!=e.liveTxts&&(i+='<span class="liveTxt" style="color:'+e.fontColor+'">'+e.liveTxts[0]+"</span>"),i+="</div>"):"plugin"==e.iconType&&(i+='<div class="plugin"></div>'),i+='<label class="name">'+e.name+"</label>",i+="</a></div>";i+='<div style="position:absolute; left: 10px; right: 10px; height: 60px; top: '+clearSpaceDivPosition+'px" ></div>',container.html(i),loadPlugins()}function loadPlugins(){for(var i in tiles)"plugin"==tiles[i].iconType&&(tile_plugins[tiles[i].id]=tile_plugins[tiles[i].id]||{},tile_plugins[tiles[i].id].initFunc?eval(tile_plugins[tiles[i].id].initFunc):fetchPlugin(tiles[i].id))}function fetchPlugin(i){var e="tile_plugins/"+i+"/index.js";$.getScript(e,function(e,l,t){tile_plugins[i].initFunc=e})}function setStyles(){$(".tile.small").css({width:small_tile_size,height:small_tile_size}),$(".tile.medium").css({width:medium_tile_size,height:medium_tile_size}),$(".tile.big").css({width:big_tile_size,height:big_tile_size}),$(".tile.rectangle").css({width:big_tile_size,height:medium_tile_size}),$(".tile .fontIcon").each(function(){var i=$(this).closest(".tile").height();$(this).css({"font-size":i/2+"px","margin-top":i/8+"px"})})}function wakeUpLive(){var i=["slideInDown","slideInLeft","slideInRight","slideInUp","rotateIn","rollIn","zoomIn"],e=["fadeIn"];$(".tile .live").each(function(){function l(){tileMovementAllowed||tileResizeAllowed||(a=(a+1)%r,d=i[Math.floor(Math.random()*i.length)],$("#"+s).find(".fontImg").attr("src",o[a]).removeClass().addClass("fontImg animated "+d)),setTimeout(l,c)}function t(){tileMovementAllowed||tileResizeAllowed||(g=(g+1)%f,d=e[Math.floor(Math.random()*e.length)],$("#"+s).find(".liveTxt").text(n[g]).removeClass().addClass("liveTxt animated "+d)),setTimeout(t,c)}var s=$(this).closest(".tile").attr("id"),o=tiles[s].liveImgUrls,n=tiles[s].liveTxts;if(void 0!=o&&o.length>1){var a=0,r=o.length,d="",c=2500+Math.round(Math.random()*(5e3/r));l()}if(void 0!=n&&n.length>1){var g=0,f=n.length,d="",c=2500+Math.round(Math.random()*(5e3/f));t()}})}function calculateWidths(){var i=20,e=containerWidth-i;page_Width_Class="xs";gridsPerRow=config.gridCapacityPerRow||12,small_tile_size=Math.floor(e/gridsPerRow),e>=1200?(page_Width_Class="lg",gridsPerRow=config.gridCapacityPerRow||16,small_tile_size=Math.floor(e/gridsPerRow)):e>=992?(page_Width_Class="md",gridsPerRow=config.gridCapacityPerRow||12):e>=768?(page_Width_Class="sm",gridsPerRow=config.gridCapacityPerRow||12):(page_Width_Class="xs",gridsPerRow=config.gridCapacityPerRow||4,small_tile_size=Math.floor((e+i)/gridsPerRow)),medium_tile_size=2*small_tile_size,big_tile_size=4*small_tile_size}function noBigTileInXS(){if("xs"==page_Width_Class)for(var i in tiles)tiles[i].size="big"==tiles[i].size?"medium":tiles[i].size}function makeGrids(){fillCapacity=0;for(var i in tiles)"small"==tiles[i].size?fillCapacity+=1:"medium"==tiles[i].size?fillCapacity+=4:"rectangle"==tiles[i].size?fillCapacity+=8:"big"==tiles[i].size&&(fillCapacity+=16);var e=gridsPerRow*Math.ceil(fillCapacity/gridsPerRow)*2;grids={};for(var l=0,t=1,i=1;e>=i;i++){l++,l>gridsPerRow&&(l=1,t++);var s={};s.indX=l,s.indY=t,s.id=l+"x"+t,s.occupiedBy="none",s.top=(t-1)*small_tile_size,s.left=(l-1)*small_tile_size,s.type="",grids[s.id]=s}}function resetGrids(){for(var i in grids)grids[i].occupiedBy="none",grids[i].type=""}function mapTilesToGrid(){clearSpaceDivPosition=0;var i="";for(var e in tileOrder)i=tileOrder[e],gridId=placeTileOnGrid(tiles[i]),tiles[i].gridId=gridId,tiles[i].width="small"==tiles[i].size?small_tile_size:"medium"==tiles[i].size?medium_tile_size:big_tile_size,tiles[i].height="small"==tiles[i].size?small_tile_size:"big"==tiles[i].size?big_tile_size:medium_tile_size,tiles[i].bgColor=tiles[i].bgColor||colorCodes[Math.floor(Math.random()*colorCodes.length)],tiles[i].top=grids[gridId].top,tiles[i].left=grids[gridId].left,clearSpaceDivPosition=tiles[i].top+tiles[i].height>clearSpaceDivPosition?tiles[i].top+tiles[i].height:clearSpaceDivPosition}function placeTileOnGrid(i){for(var e in grids)if("none"==grids[e].occupiedBy){if("small"==i.size)return grids[e].occupiedBy=i.id,grids[e].type="startGrid",e;if(canItHoldTile(grids[e].id,i.size))return markGridsOccupied(grids[e].id,i.size,i.id),grids[e].type="startGrid",e}console.log("No Grid Avaialble for Tile id="+i.id)}function canItHoldTile(i,e){for(var l="medium"==e?2:4,t="big"==e?4:2,s=grids[i].indX,o=grids[i].indY,n=s+(l-1),a=o+(t-1),r="",d=!1,c=s;n>=c;c++){for(var g=o;a>=g;g++)if(r=c+"x"+g,void 0==grids[r]||void 0==typeof grids[r]||"none"!=grids[r].occupiedBy){d=!0;break}if(d)break}return!d}function markGridsOccupied(i,e,l){for(var t="medium"==e?2:4,s="big"==e?4:2,o=grids[i].indX,n=grids[i].indY,a=o+(t-1),r=n+(s-1),d="",c=o;a>=c;c++)for(var g=n;r>=g;g++)d=c+"x"+g,grids[d].occupiedBy=l}function bindDragAndDrop(){function i(){$(".tileResizeMenu").remove(),$("#"+config.btn_ID_to_Toggle_Tile_Movement).hasClass("on")?($("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("on").addClass("off"),tileMovementAllowed=!1,container.removeClass("movementMode"),reTilefy()):($("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("off").addClass("on"),tileMovementAllowed=!0,container.addClass("movementMode").removeClass("resizeMode"),tileResizeAllowed=!1,$("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("on").addClass("off"))}var e=null,l=null,t=!1,s=0,o=0;container.on("pointerdown",".tile",function(i){container.hasClass("movementMode")&&(i.preventDefault(),t||(e=$(this).attr("id"),t=!0,s=i.pageX,o=i.pageY,container.find(".tile").removeClass("being-dragged"),$(this).addClass("being-dragged")))}),$("body").on("pointerup",function(i){if(t){if(t=!1,$("body").trigger("click"),null!=l&&null!=e){var s=[];for(var o in tileOrder)tileOrder[o]!=e&&(tileOrder[o]==l?(s.push(e),s.push(l)):s.push(tileOrder[o]));s.length!=tileOrder.length?(console.log("length mismatch... Hence this order cannot be taken..."),console.log("current tile order"),console.log(tileOrder),console.log("new tile order"),console.log(s)):tileOrder=s}reTilefy(),e=null,l=null,$(".tile").removeClass("being-dragged")}}),container.on("pointerout",function(i){$("body").trigger("pointerup")}),$("body").on("pointermove",function(i){if(i.stopPropagation(),tileMovementAllowed&&t&&null!=e){var n=i.pageX-s,a=i.pageY-o;s=i.pageX,o=i.pageY;var r=parseInt($("#"+e).css("left")),d=parseInt($("#"+e).css("top")),c=d+a,g=r+n;for(var f in tiles)if(e!=tiles[f].id&&Math.abs(tiles[f].left-r)<small_tile_size&&Math.abs(tiles[f].top-d)<small_tile_size){container.find(".tile").removeClass("shift-effect"),l=tiles[f].id,$("#"+l).addClass("shift-effect");break}$("#"+e).css({top:c,left:g})}}),$("#"+config.btn_ID_to_Toggle_Tile_Movement).on("click",function(){i()})}function enableTileResize(){function i(){$(".tileResizeMenu").remove(),$("#"+config.btn_ID_to_Toggle_Tile_Resize).hasClass("on")?($("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("on").addClass("off"),tileResizeAllowed=!1,container.removeClass("resizeMode")):($("#"+config.btn_ID_to_Toggle_Tile_Resize).removeClass("off").addClass("on"),tileResizeAllowed=!0,container.addClass("resizeMode").removeClass("movementMode"),tileMovementAllowed=!1,$("#"+config.btn_ID_to_Toggle_Tile_Movement).removeClass("on").addClass("off"),reTilefy())}$("#"+config.btn_ID_to_Toggle_Tile_Resize).on("click",function(){i()});var e='<ul class="tileResizeMenu"><li>Small</li><li>Medium</li><li>Big</li><li>Rectangle</li></ul>';container.on("click",".tile",function(i){if(container.hasClass("resizeMode")){$(".tileResizeMenu").remove();var l=parseInt($(this).css("top"))+20,t=parseInt($(this).css("left"))+20;$(e).attr("data-tileID",$(this).attr("id")).css({top:l,left:t}).appendTo(container)}}),container.on("click",".tileResizeMenu li",function(i){var e=$(this).text().toLowerCase(),l=$(this).closest(".tileResizeMenu").attr("data-tileID");tiles[l].size!=e&&(tiles[l].size=e,reTilefy())})}var thisContainer=this,container=$(this),containerWidth=container.width(),tileOrder=config.TD.tileOrder,tiles=config.TD.tiles,grids={},gridsPerRow=0,page_Width_Class="xs",small_tile_size=0,medium_tile_size=0,big_tile_size=0,clearSpaceDivPosition=200,tileMovementAllowed=!1,tileResizeAllowed=!1,colorCodes=["#632F00","#B01E00","#C1004F","#4617B4","#008287","#199900","#00C13F","#FF2E12","#FF1D77","#AA40FF","#1FAEFF","#000","#00A3A3","#FE7C22"];init(),$("body").on("click",".tile a",function(i){(tileMovementAllowed||tileResizeAllowed)&&i.preventDefault()})})}}(jQuery);